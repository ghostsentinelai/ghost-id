---
title: JavaScript (Web)
description: Official JavaScript SDK for GHOST ID Analytics
---

import { Callout } from 'fumadocs-ui/components/callout';


## Installation

```bash
npm install @ghost-id/js
```

```bash
yarn add @ghost-id/js
```

## Peer Dependencies

The SDK has an optional peer dependency for session replay functionality:

```bash
npm install rrweb
```

```bash
yarn add rrweb
```

<Callout type="info">
The `rrweb` package is only required if you enable session replay in your GHOST ID dashboard. The SDK will work without it for all other tracking features.
</Callout>

## Initialization

<Callout type="warning">
`ghost-id.init()` **must** be called once before any other tracking methods (`pageview`, `event`, etc.) can be used. Attempting to call other methods before `init` will result in errors or no tracking.
</Callout>

### Syntax

```typescript
async ghost-id.init(config: GHOST IDConfig): Promise<void>;
```

### Example

```javascript
import ghost-id from "@ghost-id/js";

await ghost-id.init({
  analyticsHost: "https://app.ghost-id.io/api",
  siteId: "1",
});
```

### Configuration Options

#### Required Options

| Option          | Type     | Description                                                                          |
| :-------------- | :------- | :----------------------------------------------------------------------------------- |
| `analyticsHost` | `string` | URL of your GHOST ID analytics instance (e.g., `https://ghost-id.yourdomain.com/api`). |
| `siteId`        | `string` | The Site ID for your website obtained from your GHOST ID instance.       |

#### Local Configuration Options

These options are configured in your code and control SDK behavior locally:

| Option                 | Type     | Default | Description                                                                                                                                                             |
| :--------------------- | :------- | :------ | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `debounceDuration`     | `number` | `500`   | Debounce time in milliseconds for tracking pageviews after route changes. Set to `0` to disable debouncing (track immediately).                                         |
| `skipPatterns`         | `string[]` | `[]`    | Array of path patterns. Pageviews whose path matches any pattern will **not** be tracked. See [Path Matching](#path-matching).                                          |
| `maskPatterns`         | `string[]` | `[]`    | Array of path patterns. For matching pageview paths, the original path will be **replaced** by the pattern itself in tracked data. See [Path Matching](#path-matching). |
| `debug`                | `boolean` | `false` | Enable detailed logging to the browser console.                                                                                                                         |
| `replayPrivacyConfig`  | `object` | -       | Privacy settings for session replay. See [Session Replay](#session-replay).                                                                                            |

#### Remote Configuration

These settings are controlled through your GHOST ID dashboard and cannot be set in the init config:

| Dashboard Setting      | Description                                                | Default |
| :--------------------- | :--------------------------------------------------------- | :------ |
| Track Initial Pageview | Track pageview on initial page load                        | `true`  |
| Track SPA Navigation   | Track pageviews on Single Page Application route changes   | `true`  |
| Track URL Parameters   | Include URL query strings in tracked data                  | `true`  |
| Track Outbound Links   | Automatically track clicks on external links               | `true`  |
| Track Web Vitals       | Track Core Web Vitals performance metrics                  | `false` |
| Capture Errors         | Enable automatic error tracking                            | `false` |
| Session Replay         | Enable session replay recording                            | `false` |

If fetching settings fails or times out, the SDK uses sensible defaults.

## Tracking Pageviews

Pageviews are tracked automatically based on your dashboard settings. This includes the initial page load and subsequent route changes in Single Page Applications (SPAs).

### Syntax

```typescript
ghost-id.pageview(path?: string);
```

### Parameters

- **`path`** (`string`, Optional):
  - Replaces the detected URL path (`window.location.pathname`) and query string (`window.location.search`) for this specific pageview event.
  - Should start with a `/` (e.g., `/virtual/my-custom-page`).
  - If `path` includes its own query string (e.g., `/virtual/step?id=123`), that query string will be used for the event. If `path` has no query string, the `querystring` property will be empty.
  - `skipPatterns` and `maskPatterns` will be applied to `path`.

### When to Use Manually

- **Automatic tracking disabled:** If you disabled automatic pageview tracking in your dashboard.
- **Virtual Pageviews:** In SPAs where a significant view change occurs without a URL change.
- **Specific Timing:** If you need to ensure a pageview is tracked only after certain conditions are met.

### Example

```javascript
// Standard manual pageview (usually not needed if auto-tracking is on)
ghost-id.pageview();

// Example: Track a step within a multi-step modal
function openUserDetailsModal(userId, step) {
  // ... logic to open and display the modal step ...
  ghost-id.pageview(`/users/${userId}/modal/${step}`);
}
openUserDetailsModal("user-abc", "contact-info");

// Example: Track a virtual pageview with its own query parameters
function showFilteredProductList(category, sortBy) {
   let virtualPathWithQuery = `/products/category/${category}?sort=${sortBy}&view=grid`;
   ghost-id.pageview(virtualPathWithQuery);
}
showFilteredProductList("electronics", "price_desc");
```

## Tracking Custom Events

Use custom events to track specific user interactions. Examples include button clicks, form submissions, or adding an item to a cart.

### Programmatic Tracking

You can trigger events from your JavaScript code.

#### Syntax

```typescript
ghost-id.event(name: string, properties?: TrackProperties);
```

#### Parameters

- **`name`** (`string`, Required): The name of the event you want to track.
- **`properties`** (`object`, Optional): An object containing additional key-value pairs related to the event. Values can be a `string`, `number`, `boolean`, or an array of these types.

#### Example

```javascript
// Track a simple button click
document.getElementById("cta-button")?.addEventListener("click", () => {
  ghost-id.event("cta_click");
});

// Track adding an item to a shopping cart with properties
function addToCart(item) {
  // ... add item ...
  ghost-id.event("add_to_cart", {
    itemId: item.id,
    itemName: item.name,
    price: item.price,
    quantity: 1
  });
}
```

### Declarative Tracking with Data Attributes

The SDK automatically listens for clicks on elements with the `data-ghost-id-event` attribute.

- `data-ghost-id-event="<event-name>"`: This attribute makes the element trackable. The value is used as the event name.
- `data-ghost-id-prop-<property-name>="<value>"`: You can add multiple properties to the event by using this attribute format. The SDK collects all attributes starting with `data-ghost-id-prop-` and includes them as key-value pairs in the event data.

#### Example

```html
<button data-ghost-id-event="cta_click">Click Me</button>

<button
  data-ghost-id-event="add_to_cart"
  data-ghost-id-prop-item_id="product-123"
  data-ghost-id-prop-item_name="Classic T-Shirt"
  data-ghost-id-prop-price="29.99"
>
  Add to Cart
</button>
```

## Tracking Outbound Links

Outbound links (links to external domains) are tracked automatically by default based on your dashboard settings. The SDK attaches a global click listener to capture clicks on `<a>` tags with external `href` attributes.

### Syntax

```typescript
ghost-id.trackOutbound(url: string, text?: string, target?: string);
```

### Parameters

- **`url`** (`string`, Required): The destination URL of the outbound link.
- **`text`** (`string`, Optional): The text content of the link. Defaults to `""`.
- **`target`** (`string`, Optional): The `target` attribute of the link (e.g., `_blank`). Defaults to `_self`.

### When to Use Manually

- **Automatic tracking disabled:** If you disabled outbound link tracking in your dashboard.
- **Non-anchor elements:** If you trigger navigation to an external site using JavaScript from an element that isn't an `<a>` tag.

### Example

```javascript
// Manually track an outbound click triggered by a button
document.getElementById("external-service-button")?.addEventListener("click", () => {
  let url = "https://external-service.com";
  ghost-id.trackOutbound(url, "Visit External Service", "_blank");
  // Optionally navigate after tracking
  window.open(url, "_blank");
});
```

## Error Tracking

The SDK can automatically capture JavaScript errors and unhandled promise rejections. This feature must be enabled in your GHOST ID dashboard.

### Automatic Error Capture

When enabled in your dashboard, the SDK will automatically track:
- Uncaught exceptions (`window.error` events)
- Unhandled promise rejections (`window.unhandledrejection` events)

### Manual Error Capture

You can manually capture errors with additional context:

#### Syntax

```typescript
ghost-id.error(error: Error | ErrorEvent, context?: TrackProperties);
```

#### Parameters

- **`error`** (`Error | ErrorEvent`, Required): The error object to capture.
- **`context`** (`object`, Optional): Additional context to include with the error.

#### Example

```javascript
try {
  // Some risky operation
  processPayment(orderData);
} catch (error) {
  ghost-id.error(error, {
    component: "checkout",
    orderId: "order-123",
    userId: currentUser.id
  });
  // Handle error in your UI
  showErrorMessage("Payment failed");
}

// Capture error from async operation
async function fetchUserData(userId) {
  try {
    const response = await fetch(`/api/users/${userId}`);
    return await response.json();
  } catch (error) {
    ghost-id.error(error, {
      endpoint: "/api/users",
      userId: userId
    });
    throw error;
  }
}
```

<Callout type="info">
Manual error capture only works when error tracking is enabled in your dashboard settings. If it's disabled, calling `error()` will log a warning.
</Callout>

## Session Replay

Session replay records user interactions on your website, allowing you to watch how users navigate and interact with your site. This feature requires the `rrweb` peer dependency.

### Installation

```bash
npm install rrweb
```

### Enabling Session Replay

Session replay must be enabled in your GHOST ID dashboard under. Once enabled, recording starts automatically when the SDK initializes.

### Manual Controls

You can manually start, stop, and check the status of session replay:

```typescript
// Start recording (only works if enabled in dashboard)
ghost-id.startSessionReplay();

// Stop recording
ghost-id.stopSessionReplay();

// Check if currently recording
const isRecording = ghost-id.isSessionReplayActive();
if (isRecording) {
  console.log("Session is being recorded");
}
```

### Privacy Configuration

Session replay includes privacy-focused defaults and configuration options:

```javascript
await ghost-id.init({
  analyticsHost: "https://app.ghost-id.io/api",
  siteId: "1",
  replayPrivacyConfig: {
    maskAllInputs: true, // Mask all input values (default: true)
    maskTextSelectors: [
      ".sensitive-data",  // Mask text in elements with this class
      "#credit-card"      // Mask specific element IDs
    ]
  }
});
```

#### Privacy Config Options

| Option              | Type                  | Description                                                     |
| :------------------ | :-------------------- | :-------------------------------------------------------------- |
| `maskAllInputs`     | `boolean`             | Mask all input values (default: `true`)                         |
| `maskTextSelectors` | `string[]`            | CSS selectors for elements whose text should be masked          |
| `blockClass`        | `string`              | CSS class name to block elements from recording                 |
| `blockSelector`     | `string`              | CSS selector to block elements from recording                   |
| `ignoreClass`       | `string`              | CSS class name to ignore elements from recording                |
| `ignoreSelector`    | `string`              | CSS selector to ignore elements from recording                  |
| `maskTextClass`     | `string`              | CSS class name to mask text content                             |
| `collectFonts`      | `boolean`             | Whether to collect font information                             |
| `slimDOMOptions`    | `object \| boolean`   | Options to reduce DOM snapshot size                             |
| `batchSize`         | `number`              | Number of events to batch before sending                        |
| `batchInterval`     | `number`              | Interval in milliseconds between batched sends                  |

## User Identification

You can associate tracking events with a specific user ID and optional traits. The ID is persisted in `localStorage` and will be attached to all subsequent tracking events for that user.

### `identify`

Assigns a user ID with optional traits.

```typescript
ghost-id.identify(userId: string, traits?: Record<string, unknown>);
```

**Parameters:**

- **`userId`** (`string`, Required): The user ID to associate with tracking events.
- **`traits`** (`object`, Optional): An object containing user attributes/properties.

**Example:**

```javascript
// After a user logs in
ghost-id.identify("user-xzy-123");

// With traits
ghost-id.identify("user-xzy-123", {
  email: "user@example.com",
  plan: "premium",
  signupDate: "2024-01-15"
});
```

### `setTraits`

Updates traits for the currently identified user without changing the user ID.

```typescript
ghost-id.setTraits(traits: Record<string, unknown>);
```

**Example:**

```javascript
// Update user traits after they upgrade
ghost-id.setTraits({
  plan: "enterprise",
  upgradeDate: "2024-03-01"
});
```

### `clearUserId`

Clears the stored user ID.

```typescript
ghost-id.clearUserId();
```

**Example:**

```javascript
// When a user logs out
ghost-id.clearUserId();
```

### `getUserId`

Retrieves the currently stored user ID.

```typescript
ghost-id.getUserId(): string | null;
```

**Example:**

```javascript
let currentUserId = ghost-id.getUserId();
console.log("Current GHOST ID User ID:", currentUserId);
```

## Page Change Callbacks

Register callbacks that execute when the page or route changes. This is useful for integrating with third-party tools or triggering custom logic on navigation.

### Syntax

```typescript
ghost-id.onPageChange(callback: (newPath: string, previousPath: string) => void): () => void;
```

### Parameters

- **`callback`** (`function`, Required): Function to execute on page change. Receives:
  - `newPath`: The new pathname
  - `previousPath`: The previous pathname

### Returns

Returns an unsubscribe function to remove the callback.

### Example

```javascript
// Register a callback
const unsubscribe = ghost-id.onPageChange((newPath, previousPath) => {
  console.log(`Navigated from ${previousPath} to ${newPath}`);

  // Example: Track scroll position reset
  window.scrollTo(0, 0);
});

// Later, to remove the callback
unsubscribe();

// Example: Multiple callbacks can be registered
ghost-id.onPageChange((newPath) => {
  // Update page title
  document.title = `${newPath} - My Site`;
});

ghost-id.onPageChange((newPath, previousPath) => {
  // Log navigation for debugging
  if (process.env.NODE_ENV === 'development') {
    console.log('Navigation:', { from: previousPath, to: newPath });
  }
});
```

<Callout type="info">
Callbacks are only triggered when the pathname actually changes. Multiple calls to the same path won't trigger callbacks repeatedly.
</Callout>

## Cleanup

In Single Page Applications or other dynamic environments, you may need to manually clean up the listeners that the SDK sets up.

### Syntax

```typescript
ghost-id.cleanup();
```

### What Gets Cleaned Up

- SPA route change listeners (`popstate`, `hashchange`)
- Outbound link click listeners
- Data attribute click listeners
- Error tracking listeners
- Session replay recording
- Page change callbacks
- Resets initialization state

### Example

```javascript
// In React
useEffect(() => {
  ghost-id.init({
    analyticsHost: "https://app.ghost-id.io/api",
    siteId: "1",
  });

  return () => {
    ghost-id.cleanup();
  };
}, []);
```

## Path Matching

These options allow you to control which page paths are tracked and how they appear in your analytics data using wildcard patterns.

### Wildcards

- `*`: Matches any sequence of characters **except** the forward slash (`/`). Useful for matching single path segments.
- `**`: Matches any sequence of characters **including** the forward slash (`/`). Useful for matching multiple path segments.

### `skipPatterns`

If a page's path matches any pattern in `skipPatterns`, the pageview for that path will **not** be sent.

**Examples:**

- `"/admin/*"`: Skips `/admin/login`, `/admin/users`, but **not** `/admin/settings/profile`.
- `"/admin/**"`: Skips `/admin/login`, `/admin/users`, *and* `/admin/settings/profile`.
- `"/users/*/profile"`: Skips `/users/123/profile`, `/users/abc/profile`, but **not** `/users/123/settings`.

```javascript
// Example skipPatterns in init
await ghost-id.init({
  // ... other options
  skipPatterns: [
    "/admin/**",        // Skip all admin sections
    "/debug",           // Skip exact /debug path
    "/users/*/settings" // Skip settings page for any user
  ]
});
```

### `maskPatterns`

If a page's path matches a pattern in `maskPatterns`, the pageview **will** be sent, but the `pathname` will be **replaced** by the pattern string itself. This is useful for grouping similar pages or hiding sensitive IDs.

<Callout type="warning">
If a path matches both a `skipPatterns` and a `maskPatterns` pattern, **skipping takes priority**.
</Callout>

**Examples:**

- Pattern: `"/users/*/profile"`
  - `/users/123/profile` is tracked as `pathname: "/users/*/profile"`.
- Pattern: `"/products/**"`
  - `/products/electronics/tv-123` is tracked as `pathname: "/products/**"`.

```javascript
// Example maskPatterns in init
await ghost-id.init({
  // ... other options
  maskPatterns: [
    "/users/*/profile",  // Group all user profile views
    "/orders/*"          // Mask specific order IDs
  ]
});
```

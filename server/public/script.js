"use strict";(()=>{var Ie=Object.defineProperty;var Ae=(r,e,t)=>e in r?Ie(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e,t)=>Ae(r,typeof e!="symbol"?e+"":e,t);function Me(r){let e="__DOUBLE_ASTERISK_TOKEN__",t="__SINGLE_ASTERISK_TOKEN__",n=r.replace(/\*\*/g,e).replace(/\*/g,t).replace(/[.+?^${}()|[\]\\]/g,"\\$&");n=n.replace(new RegExp(`/${e}/`,"g"),"/(?:.+/)?"),n=n.replace(new RegExp(e,"g"),".*"),n=n.replace(/\//g,"\\/");let o=n.replace(new RegExp(t,"g"),"[^/]+");return new RegExp("^"+o+"$")}function x(r,e){for(let t of e)try{if(Me(t).test(r))return t}catch(i){console.error(`Invalid pattern: ${t}`,i)}return null}function ee(r,e){let t=null;return(...i)=>{t&&clearTimeout(t),t=setTimeout(()=>r(...i),e)}}function te(r){try{let e=window.location.hostname,t=new URL(r).hostname;return t!==e&&t!==""}catch{return!1}}function m(r,e){if(!r)return e;try{let t=JSON.parse(r);return Array.isArray(e)&&!Array.isArray(t)?e:t}catch(t){return console.error("Error parsing JSON:",t),e}}async function ie(r){let e=r.getAttribute("src");if(!e)return console.error("Script src attribute is missing"),null;let t=e.split("/script.js")[0];if(!t)return console.error("Please provide a valid analytics host"),null;let i=r.getAttribute("data-site-id")||r.getAttribute("site-id");if(!i)return console.error("Please provide a valid site ID using the data-site-id attribute"),null;let n=r.getAttribute("data-namespace")||"rybbit",o=m(r.getAttribute("data-skip-patterns"),[]),a=m(r.getAttribute("data-mask-patterns"),[]),c=m(r.getAttribute("data-replay-mask-text-selectors"),[]),s=r.getAttribute("data-debounce")?Math.max(0,parseInt(r.getAttribute("data-debounce"))):500,l=r.getAttribute("data-replay-batch-size")?Math.max(1,parseInt(r.getAttribute("data-replay-batch-size"))):250,d=r.getAttribute("data-replay-batch-interval")?Math.max(1e3,parseInt(r.getAttribute("data-replay-batch-interval"))):5e3,C=r.getAttribute("data-replay-block-class")||void 0,v=r.getAttribute("data-replay-block-selector")||void 0,B=r.getAttribute("data-replay-ignore-class")||void 0,be=r.getAttribute("data-replay-ignore-selector")||void 0,Re=r.getAttribute("data-replay-mask-text-class")||void 0,K=r.getAttribute("data-replay-mask-all-inputs"),Ce=K!==null?K!=="false":void 0,q=r.getAttribute("data-replay-mask-input-options"),Te=q?m(q,{password:!0,email:!0}):void 0,G=r.getAttribute("data-replay-collect-fonts"),we=G!==null?G!=="false":void 0,Q=r.getAttribute("data-replay-sampling"),Se=Q?m(Q,{}):void 0,Y=r.getAttribute("data-replay-slim-dom-options"),Ee=Y?m(Y,{}):void 0,X=r.getAttribute("data-replay-sample-rate"),Pe=X?Math.min(100,Math.max(0,parseInt(X,10))):void 0,u={namespace:n,analyticsHost:t,siteId:i,debounceDuration:s,sessionReplayBatchSize:l,sessionReplayBatchInterval:d,sessionReplayMaskTextSelectors:c,skipPatterns:o,maskPatterns:a,autoTrackPageview:!0,autoTrackSpa:!0,trackQuerystring:!0,trackOutbound:!0,enableWebVitals:!1,trackErrors:!1,enableSessionReplay:!1,trackButtonClicks:!1,trackRageClicks:!1,trackDeadClicks:!1,trackCopy:!1,sessionReplayBlockClass:C,sessionReplayBlockSelector:v,sessionReplayIgnoreClass:B,sessionReplayIgnoreSelector:be,sessionReplayMaskTextClass:Re,sessionReplayMaskAllInputs:Ce,sessionReplayMaskInputOptions:Te,sessionReplayCollectFonts:we,sessionReplaySampling:Se,sessionReplaySlimDOMOptions:Ee,sessionReplaySampleRate:Pe};try{let L=`${t}/site/tracking-config/${i}`,Z=await fetch(L,{method:"GET",credentials:"omit"});if(Z.ok){let p=await Z.json();return{...u,autoTrackPageview:p.trackInitialPageView??u.autoTrackPageview,autoTrackSpa:p.trackSpaNavigation??u.autoTrackSpa,trackQuerystring:p.trackUrlParams??u.trackQuerystring,trackOutbound:p.trackOutbound??u.trackOutbound,enableWebVitals:p.webVitals??u.enableWebVitals,trackErrors:p.trackErrors??u.trackErrors,enableSessionReplay:p.sessionReplay??u.enableSessionReplay,trackButtonClicks:p.trackButtonClicks??u.trackButtonClicks,trackRageClicks:p.trackRageClicks??u.trackRageClicks,trackDeadClicks:p.trackDeadClicks??u.trackDeadClicks,trackCopy:p.trackCopy??u.trackCopy}}else return console.warn("Failed to fetch tracking config from API, using defaults"),u}catch(L){return console.warn("Error fetching tracking config:",L),u}}var re="rybbit-replay-sampled";function Be(r){if(r>=100)return!0;if(r<=0)return!1;try{let e=sessionStorage.getItem(re);if(e!==null)return e==="1";let t=Math.random()*100<r;return sessionStorage.setItem(re,t?"1":"0"),t}catch{return Math.random()*100<r}}var T=class{constructor(e,t,i){this.isRecording=!1;this.eventBuffer=[];this.config=e,this.userId=t,this.sendBatch=i}async initialize(){if(!this.config.enableSessionReplay)return;let e=this.config.sessionReplaySampleRate;e!==void 0&&!Be(e)||(window.rrweb||await this.loadRrweb(),window.rrweb&&this.startRecording())}async loadRrweb(){return new Promise((e,t)=>{let i=document.createElement("script");i.src=`${this.config.analyticsHost}/replay.js`,i.async=!1,i.onload=()=>{e()},i.onerror=()=>t(new Error("Failed to load rrweb")),document.head.appendChild(i)})}startRecording(){if(!(this.isRecording||!window.rrweb||!this.config.enableSessionReplay))try{let e={mousemove:!1,mouseInteraction:{MouseUp:!1,MouseDown:!1,Click:!0,ContextMenu:!1,DblClick:!0,Focus:!0,Blur:!0,TouchStart:!1,TouchEnd:!1},scroll:500,input:"last",media:800},t={script:!1,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0},i={emit:n=>{this.addEvent({type:n.type,data:n.data,timestamp:n.timestamp||Date.now()})},recordCanvas:!1,checkoutEveryNms:6e4,checkoutEveryNth:500,blockClass:this.config.sessionReplayBlockClass??"rr-block",blockSelector:this.config.sessionReplayBlockSelector??null,ignoreClass:this.config.sessionReplayIgnoreClass??"rr-ignore",ignoreSelector:this.config.sessionReplayIgnoreSelector??null,maskTextClass:this.config.sessionReplayMaskTextClass??"rr-mask",maskAllInputs:this.config.sessionReplayMaskAllInputs??!0,maskInputOptions:this.config.sessionReplayMaskInputOptions??{password:!0,email:!0},collectFonts:this.config.sessionReplayCollectFonts??!0,sampling:this.config.sessionReplaySampling??e,slimDOMOptions:this.config.sessionReplaySlimDOMOptions??t};this.config.sessionReplayMaskTextSelectors&&this.config.sessionReplayMaskTextSelectors.length>0&&(i.maskTextSelector=this.config.sessionReplayMaskTextSelectors.join(", ")),this.stopRecordingFn=window.rrweb.record(i),this.isRecording=!0,this.setupBatchTimer()}catch{}}stopRecording(){this.isRecording&&(this.stopRecordingFn&&this.stopRecordingFn(),this.isRecording=!1,this.clearBatchTimer(),this.eventBuffer.length>0&&this.flushEvents())}isActive(){return this.isRecording}addEvent(e){this.eventBuffer.push(e),this.eventBuffer.length>=this.config.sessionReplayBatchSize&&this.flushEvents()}setupBatchTimer(){this.clearBatchTimer(),this.batchTimer=window.setInterval(()=>{this.eventBuffer.length>0&&this.flushEvents()},this.config.sessionReplayBatchInterval)}clearBatchTimer(){this.batchTimer&&(clearInterval(this.batchTimer),this.batchTimer=void 0)}async flushEvents(){if(this.eventBuffer.length===0)return;let e=[...this.eventBuffer];this.eventBuffer=[];let t={userId:this.userId,events:e,metadata:{pageUrl:window.location.href,viewportWidth:screen.width,viewportHeight:screen.height,language:navigator.language}};try{await this.sendBatch(t)}catch{this.eventBuffer.unshift(...e)}}updateUserId(e){this.userId=e}onPageChange(){this.isRecording&&this.flushEvents()}cleanup(){this.stopRecording()}};var w=class{constructor(e){this.customUserId=null;this.config=e,this.loadUserId(),e.enableSessionReplay&&this.initializeSessionReplay()}loadUserId(){try{let e=localStorage.getItem(`${this.config.namespace}-user-id`);e&&(this.customUserId=e)}catch{}}async initializeSessionReplay(){try{this.sessionReplayRecorder=new T(this.config,this.customUserId||"",e=>this.sendSessionReplayBatch(e)),await this.sessionReplayRecorder.initialize()}catch(e){console.error("Failed to initialize session replay:",e)}}async sendSessionReplayBatch(e){try{await fetch(`${this.config.analyticsHost}/session-replay/record/${this.config.siteId}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!1})}catch(t){throw console.error("Failed to send session replay batch:",t),t}}createBasePayload(){let e=new URL(window.location.href),t=e.pathname;if(e.hash&&e.hash.startsWith("#/")&&(t=e.hash.substring(1)),x(t,this.config.skipPatterns))return null;let i=x(t,this.config.maskPatterns);i&&(t=i);let n={site_id:this.config.siteId,hostname:e.hostname,pathname:t,querystring:this.config.trackQuerystring?e.search:"",screenWidth:screen.width,screenHeight:screen.height,language:navigator.language,page_title:document.title,referrer:document.referrer};return this.customUserId&&(n.user_id=this.customUserId),n}async sendTrackingData(e){try{await fetch(`${this.config.analyticsHost}/track`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),mode:"cors",keepalive:!0})}catch(t){console.error("Failed to send tracking data:",t)}}track(e,t="",i={}){if(e==="custom_event"&&(!t||typeof t!="string")){console.error("Event name is required and must be a string for custom events");return}let n=this.createBasePayload();if(!n)return;let a={...n,type:e,event_name:t,properties:["custom_event","outbound","error","button_click","rage_click","dead_click","copy"].includes(e)?JSON.stringify(i):void 0};this.sendTrackingData(a)}trackPageview(){this.track("pageview")}trackEvent(e,t={}){this.track("custom_event",e,t)}trackOutbound(e,t="",i="_self"){this.track("outbound","",{url:e,text:t,target:i})}trackWebVitals(e){let t=this.createBasePayload();if(!t)return;let i={...t,type:"performance",event_name:"web-vitals",...e};this.sendTrackingData(i)}trackError(e,t={}){let i=window.location.origin,n=t.filename||"",o=e.stack||"";if(n)try{if(new URL(n).origin!==i)return}catch{}else if(o&&!o.includes(i))return;let a={message:e.message?.substring(0,500)||"Unknown error",stack:o.substring(0,2e3)||""};if(n&&(a.fileName=n),t.lineno){let c=typeof t.lineno=="string"?parseInt(t.lineno,10):t.lineno;c&&c!==0&&(a.lineNumber=c)}if(t.colno){let c=typeof t.colno=="string"?parseInt(t.colno,10):t.colno;c&&c!==0&&(a.columnNumber=c)}for(let c in t)!["lineno","colno"].includes(c)&&t[c]!==void 0&&(a[c]=t[c]);this.track("error",e.name||"Error",a)}trackButtonClick(e){this.track("button_click","",e)}trackRageClick(e){this.track("rage_click","",e)}trackDeadClick(e){this.track("dead_click","",e)}trackCopy(e){this.track("copy","",e)}identify(e,t){if(typeof e!="string"||e.trim()===""){console.error("User ID must be a non-empty string");return}this.customUserId=e.trim();try{localStorage.setItem(`${this.config.namespace}-user-id`,this.customUserId)}catch{console.warn("Could not persist user ID to localStorage")}this.sendIdentifyEvent(this.customUserId,t,!0),this.sessionReplayRecorder&&this.sessionReplayRecorder.updateUserId(this.customUserId)}setTraits(e){if(!e||typeof e!="object"){console.error("Traits must be an object");return}let t=this.customUserId;if(!t){console.warn("Cannot set traits without identifying user first. Call identify() first.");return}this.sendIdentifyEvent(t,e,!1)}async sendIdentifyEvent(e,t,i=!0){try{await fetch(`${this.config.analyticsHost}/identify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_id:this.config.siteId,user_id:e,traits:t,is_new_identify:i}),mode:"cors",keepalive:!0})}catch(n){console.error("Failed to send identify event:",n)}}clearUserId(){this.customUserId=null;try{localStorage.removeItem(`${this.config.namespace}-user-id`)}catch{}}getUserId(){return this.customUserId}startSessionReplay(){this.sessionReplayRecorder?this.sessionReplayRecorder.startRecording():console.warn("Session replay not initialized")}stopSessionReplay(){this.sessionReplayRecorder&&this.sessionReplayRecorder.stopRecording()}isSessionReplayActive(){return this.sessionReplayRecorder?.isActive()??!1}onPageChange(){this.sessionReplayRecorder&&this.sessionReplayRecorder.onPageChange()}cleanup(){this.sessionReplayRecorder&&this.sessionReplayRecorder.cleanup()}};var pe=-1,k=r=>{addEventListener("pageshow",(e=>{e.persisted&&(pe=e.timeStamp,r(e))}),!0)},h=(r,e,t,i)=>{let n,o;return a=>{e.value>=0&&(a||i)&&(o=e.value-(n??0),(o||n===void 0)&&(n=e.value,e.delta=o,e.rating=((c,s)=>c>s[1]?"poor":c>s[0]?"needs-improvement":"good")(e.value,t),r(e)))}},V=r=>{requestAnimationFrame((()=>requestAnimationFrame((()=>r()))))},z=()=>{let r=performance.getEntriesByType("navigation")[0];if(r&&r.responseStart>0&&r.responseStart<performance.now())return r},b=()=>z()?.activationStart??0,g=(r,e=-1)=>{let t=z(),i="navigate";return pe>=0?i="back-forward-cache":t&&(document.prerendering||b()>0?i="prerender":document.wasDiscarded?i="restore":t.type&&(i=t.type.replace(/_/g,"-"))),{name:r,value:e,rating:"good",delta:0,entries:[],id:`v5-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:i}},D=new WeakMap;function $(r,e){return D.get(r)||D.set(r,new e),D.get(r)}var N=class{constructor(){f(this,"t");f(this,"i",0);f(this,"o",[])}h(e){if(e.hadRecentInput)return;let t=this.o[0],i=this.o.at(-1);this.i&&t&&i&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(this.i+=e.value,this.o.push(e)):(this.i=e.value,this.o=[e]),this.t?.(e)}},R=(r,e,t={})=>{try{if(PerformanceObserver.supportedEntryTypes.includes(r)){let i=new PerformanceObserver((n=>{Promise.resolve().then((()=>{e(n.getEntries())}))}));return i.observe({type:r,buffered:!0,...t}),i}}catch{}},j=r=>{let e=!1;return()=>{e||(r(),e=!0)}},y=-1,he=new Set,ne=()=>document.visibilityState!=="hidden"||document.prerendering?1/0:0,_=r=>{if(document.visibilityState==="hidden"){if(r.type==="visibilitychange")for(let e of he)e();isFinite(y)||(y=r.type==="visibilitychange"?r.timeStamp:0,removeEventListener("prerenderingchange",_,!0))}},E=()=>{if(y<0){let r=b();y=(document.prerendering?void 0:globalThis.performance.getEntriesByType("visibility-state").filter((t=>t.name==="hidden"&&t.startTime>r))[0]?.startTime)??ne(),addEventListener("visibilitychange",_,!0),addEventListener("prerenderingchange",_,!0),k((()=>{setTimeout((()=>{y=ne()}))}))}return{get firstHiddenTime(){return y},onHidden(r){he.add(r)}}},P=r=>{document.prerendering?addEventListener("prerenderingchange",(()=>r()),!0):r()},se=[1800,3e3],J=(r,e={})=>{P((()=>{let t=E(),i,n=g("FCP"),o=R("paint",(a=>{for(let c of a)c.name==="first-contentful-paint"&&(o.disconnect(),c.startTime<t.firstHiddenTime&&(n.value=Math.max(c.startTime-b(),0),n.entries.push(c),i(!0)))}));o&&(i=h(r,n,se,e.reportAllChanges),k((a=>{n=g("FCP"),i=h(r,n,se,e.reportAllChanges),V((()=>{n.value=performance.now()-a.timeStamp,i(!0)}))})))}))},ae=[.1,.25],ge=(r,e={})=>{let t=E();J(j((()=>{let i,n=g("CLS",0),o=$(e,N),a=s=>{for(let l of s)o.h(l);o.i>n.value&&(n.value=o.i,n.entries=o.o,i())},c=R("layout-shift",a);c&&(i=h(r,n,ae,e.reportAllChanges),t.onHidden((()=>{a(c.takeRecords()),i(!0)})),k((()=>{o.i=0,n=g("CLS",0),i=h(r,n,ae,e.reportAllChanges),V((()=>i()))})),setTimeout(i))})))},fe=0,O=1/0,S=0,Le=r=>{for(let e of r)e.interactionId&&(O=Math.min(O,e.interactionId),S=Math.max(S,e.interactionId),fe=S?(S-O)/7+1:0)},U,oe=()=>U?fe:performance.interactionCount??0,xe=()=>{"interactionCount"in performance||U||(U=R("event",Le,{type:"event",buffered:!0,durationThreshold:0}))},ce=0,H=class{constructor(){f(this,"u",[]);f(this,"l",new Map);f(this,"m");f(this,"p")}v(){ce=oe(),this.u.length=0,this.l.clear()}L(){let e=Math.min(this.u.length-1,Math.floor((oe()-ce)/50));return this.u[e]}h(e){if(this.m?.(e),!e.interactionId&&e.entryType!=="first-input")return;let t=this.u.at(-1),i=this.l.get(e.interactionId);if(i||this.u.length<10||e.duration>t.P){if(i?e.duration>i.P?(i.entries=[e],i.P=e.duration):e.duration===i.P&&e.startTime===i.entries[0].startTime&&i.entries.push(e):(i={id:e.interactionId,entries:[e],P:e.duration},this.l.set(i.id,i),this.u.push(i)),this.u.sort(((n,o)=>o.P-n.P)),this.u.length>10){let n=this.u.splice(10);for(let o of n)this.l.delete(o.id)}this.p?.(i)}}},me=r=>{let e=globalThis.requestIdleCallback||setTimeout;document.visibilityState==="hidden"?r():(r=j(r),addEventListener("visibilitychange",r,{once:!0,capture:!0}),e((()=>{r(),removeEventListener("visibilitychange",r,{capture:!0})})))},le=[200,500],ye=(r,e={})=>{if(!globalThis.PerformanceEventTiming||!("interactionId"in PerformanceEventTiming.prototype))return;let t=E();P((()=>{xe();let i,n=g("INP"),o=$(e,H),a=s=>{me((()=>{for(let d of s)o.h(d);let l=o.L();l&&l.P!==n.value&&(n.value=l.P,n.entries=l.entries,i())}))},c=R("event",a,{durationThreshold:e.durationThreshold??40});i=h(r,n,le,e.reportAllChanges),c&&(c.observe({type:"first-input",buffered:!0}),t.onHidden((()=>{a(c.takeRecords()),i(!0)})),k((()=>{o.v(),n=g("INP"),i=h(r,n,le,e.reportAllChanges)})))}))},F=class{constructor(){f(this,"m")}h(e){this.m?.(e)}},de=[2500,4e3],ke=(r,e={})=>{P((()=>{let t=E(),i,n=g("LCP"),o=$(e,F),a=s=>{e.reportAllChanges||(s=s.slice(-1));for(let l of s)o.h(l),l.startTime<t.firstHiddenTime&&(n.value=Math.max(l.startTime-b(),0),n.entries=[l],i())},c=R("largest-contentful-paint",a);if(c){i=h(r,n,de,e.reportAllChanges);let s=j((()=>{a(c.takeRecords()),c.disconnect(),i(!0)})),l=d=>{d.isTrusted&&(me(s),removeEventListener(d.type,l,{capture:!0}))};for(let d of["keydown","click","visibilitychange"])addEventListener(d,l,{capture:!0});k((d=>{n=g("LCP"),i=h(r,n,de,e.reportAllChanges),V((()=>{n.value=performance.now()-d.timeStamp,i(!0)}))}))}}))},ue=[800,1800],W=r=>{document.prerendering?P((()=>W(r))):document.readyState!=="complete"?addEventListener("load",(()=>W(r)),!0):setTimeout(r)},ve=(r,e={})=>{let t=g("TTFB"),i=h(r,t,ue,e.reportAllChanges);W((()=>{let n=z();n&&(t.value=Math.max(n.responseStart-b(),0),t.entries=[n],i(!0),k((()=>{t=g("TTFB",0),i=h(r,t,ue,e.reportAllChanges),i(!0)})))}))};var I=class{constructor(e){this.data={lcp:null,cls:null,inp:null,fcp:null,ttfb:null};this.sent=!1;this.timeout=null;this.onReadyCallback=null;this.onReadyCallback=e}initialize(){try{ke(this.collectMetric.bind(this)),ge(this.collectMetric.bind(this)),ye(this.collectMetric.bind(this)),J(this.collectMetric.bind(this)),ve(this.collectMetric.bind(this)),this.timeout=setTimeout(()=>{this.sent||this.sendData()},2e4),window.addEventListener("beforeunload",()=>{this.sent||this.sendData()})}catch(e){console.warn("Error initializing web vitals tracking:",e)}}collectMetric(e){if(this.sent)return;let t=e.name.toLowerCase();this.data[t]=e.value,Object.values(this.data).every(n=>n!==null)&&this.sendData()}sendData(){this.sent||(this.sent=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.onReadyCallback&&this.onReadyCallback(this.data))}getData(){return{...this.data}}};var A=class{constructor(e,t){this.clickHistory=[];this.rageClickThreshold=3;this.rageClickTimeWindow=500;this.rageClickRadiusThreshold=30;this.deadClickObserverTimeout=100;this.isProcessingClick=!1;this.tracker=e,this.config=t}initialize(){document.addEventListener("click",this.handleClick.bind(this),!0)}handleClick(e){if(this.isProcessingClick)return;this.isProcessingClick=!0;let t=e.target,i=Date.now();this.config.trackRageClicks&&this.trackRageClickIfDetected(e,i),this.config.trackButtonClicks&&this.isButton(t)&&this.trackButtonClick(t),this.config.trackDeadClicks&&!this.isInteractiveElement(t)&&this.trackDeadClickIfDetected(t),this.isProcessingClick=!1}isButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return!0;if(e.tagName==="INPUT"){let n=e.type?.toLowerCase();if(n==="submit"||n==="button")return!0}let t=e.parentElement,i=0;for(;t&&i<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return!0;t=t.parentElement,i++}return!1}isInteractiveElement(e){let t=["A","BUTTON","INPUT","SELECT","TEXTAREA","VIDEO","AUDIO"],i=["button","link","checkbox","radio","tab","menuitem","option"];if(t.includes(e.tagName)||e.hasAttribute("onclick")||e.hasAttribute("tabindex"))return!0;let n=e.getAttribute("role");if(n&&i.includes(n)||e.style.cursor==="pointer"||window.getComputedStyle(e).cursor==="pointer")return!0;let a=e.parentElement,c=0;for(;a&&c<3;){if(t.includes(a.tagName)||a.hasAttribute("onclick"))return!0;let s=a.getAttribute("role");if(s&&i.includes(s))return!0;a=a.parentElement,c++}return!1}trackButtonClick(e){let t=this.findButton(e);if(!t)return;let i={element:t.tagName.toLowerCase(),text:this.getElementText(t)};this.tracker.trackButtonClick(i)}findButton(e){if(e.tagName==="BUTTON"||e.getAttribute("role")==="button")return e;if(e.tagName==="INPUT"){let n=e.type?.toLowerCase();if(n==="submit"||n==="button")return e}let t=e.parentElement,i=0;for(;t&&i<3;){if(t.tagName==="BUTTON"||t.getAttribute("role")==="button")return t;t=t.parentElement,i++}return null}trackRageClickIfDetected(e,t){let{clientX:i,clientY:n}=e;if(this.clickHistory.push({x:i,y:n,timestamp:t}),this.clickHistory=this.clickHistory.filter(o=>t-o.timestamp<=this.rageClickTimeWindow),this.clickHistory.length>=this.rageClickThreshold){let o=this.clickHistory.filter(a=>Math.sqrt(Math.pow(a.x-i,2)+Math.pow(a.y-n,2))<=this.rageClickRadiusThreshold);if(o.length>=this.rageClickThreshold){let a=e.target,c={clickCount:o.length,element:a.tagName.toLowerCase(),text:this.getElementText(a)};this.tracker.trackRageClick(c),this.clickHistory=[]}}}trackDeadClickIfDetected(e){let t=!1,i=new MutationObserver(()=>{t=!0});i.observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0}),setTimeout(()=>{if(i.disconnect(),!t){let n={element:e.tagName.toLowerCase(),text:this.getElementText(e)};this.tracker.trackDeadClick(n)}},this.deadClickObserverTimeout)}getElementText(e){return e.textContent?.trim().substring(0,100)||void 0}cleanup(){document.removeEventListener("click",this.handleClick.bind(this),!0),this.clickHistory=[]}};var M=class{constructor(e){this.tracker=e}initialize(){document.addEventListener("copy",this.handleCopy.bind(this))}handleCopy(){let e=window.getSelection();if(!e||e.isCollapsed)return;let i=e.toString().length;if(i===0)return;let n=e.anchorNode,o=n instanceof HTMLElement?n:n?.parentElement;if(!o)return;let a={textLength:i,sourceElement:o.tagName.toLowerCase()};this.tracker.trackCopy(a)}cleanup(){document.removeEventListener("copy",this.handleCopy.bind(this))}};(async function(){let r=document.currentScript;if(!r){console.error("Could not find current script tag");return}let e=r.getAttribute("data-namespace")||"rybbit",t=`disable-${e}`;if(window.__RYBBIT_OPTOUT__||localStorage.getItem(t)!==null){window[e]={pageview:()=>{},event:()=>{},error:()=>{},trackOutbound:()=>{},identify:()=>{},setTraits:()=>{},clearUserId:()=>{},getUserId:()=>null,startSessionReplay:()=>{},stopSessionReplay:()=>{},isSessionReplayActive:()=>!1};return}let i=await ie(r);if(!i)return;let n=new w(i);i.enableWebVitals&&new I(l=>{n.trackWebVitals(l)}).initialize(),(i.trackButtonClicks||i.trackRageClicks||i.trackDeadClicks)&&new A(n,i).initialize(),i.trackCopy&&new M(n).initialize(),i.trackErrors&&(window.addEventListener("error",s=>{n.trackError(s.error||new Error(s.message),{filename:s.filename,lineno:s.lineno,colno:s.colno})}),window.addEventListener("unhandledrejection",s=>{let l=s.reason instanceof Error?s.reason:new Error(String(s.reason));n.trackError(l,{type:"unhandledrejection"})}));let o=()=>n.trackPageview(),a=i.debounceDuration>0?ee(o,i.debounceDuration):o;function c(){if(document.addEventListener("click",function(s){let l=s.target;for(;l&&l!==document.documentElement;){if(l.hasAttribute("data-rybbit-event")){let d=l.getAttribute("data-rybbit-event");if(d){let C={};for(let v of l.attributes)if(v.name.startsWith("data-rybbit-prop-")){let B=v.name.replace("data-rybbit-prop-","");C[B]=v.value}n.trackEvent(d,C)}break}l=l.parentElement}if(i.trackOutbound){let d=s.target.closest("a");d?.href&&te(d.href)&&n.trackOutbound(d.href,d.innerText||d.textContent||"",d.target||"_self")}}),i.autoTrackSpa){let s=history.pushState,l=history.replaceState;history.pushState=function(...d){s.apply(this,d),a(),n.onPageChange()},history.replaceState=function(...d){l.apply(this,d),a(),n.onPageChange()},window.addEventListener("popstate",()=>{a(),n.onPageChange()}),window.addEventListener("hashchange",()=>{a(),n.onPageChange()})}}window[i.namespace]={pageview:()=>n.trackPageview(),event:(s,l={})=>n.trackEvent(s,l),error:(s,l={})=>n.trackError(s,l),trackOutbound:(s,l="",d="_self")=>n.trackOutbound(s,l,d),identify:(s,l)=>n.identify(s,l),setTraits:s=>n.setTraits(s),clearUserId:()=>n.clearUserId(),getUserId:()=>n.getUserId(),startSessionReplay:()=>n.startSessionReplay(),stopSessionReplay:()=>n.stopSessionReplay(),isSessionReplayActive:()=>n.isSessionReplayActive()},c(),window.addEventListener("beforeunload",()=>{n.cleanup()}),i.autoTrackPageview&&n.trackPageview()})();})();
